<html>
	<head>
		<title>John Paul Hayes II</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<link href="https://fonts.googleapis.com/css?family=Vollkorn" rel="stylesheet">
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
		<link rel="stylesheet" type="text/css" href="/index.css">
		
		<script src="/index.js"></script>
	</head>
	<body>
		<!-- Set to display:flex; to show this loading screen. -->
		<div id="loadingScreen" style="z-index:1;display:none;align-items:center;justify-content:center;width:100%;height:100%;overflow:auto;background-color:white;">
			<svg style="width:80;height:80;">
				<rect x="0" y="0" height="16" width="16" style="fill:crimson;">
					<animate id="box1a1" attributeName="x"
						from="0"  to="60"
						begin="0s; box1a2.end" dur="1s"
						fill="freeze"/>
					<animate id="box1a2" attributeName="y"
						from="0"  to="60"
						begin="box1a1.end" dur="750ms"
						fill="remove"/>
				</rect>
				<rect x="60" y="60" height="16" width="16" style="fill:crimson;">
					<animate id="box2a1" attributeName="x"
						from="60"  to="0"
						begin="0s; box2a2.end" dur="1s"
						fill="freeze"/>
					<animate id="box2a2" attributeName="y"
						from="60"  to="0"
						begin="box2a1.end;" dur="750ms"
						fill="remove"/>
				</rect>
			</svg>
		</div>
		<table id="banner"><tr><td>
			<div id="bannerleft">
				<div id="icon"><a href="/index.html"><img src="/favicon.ico"/></a></div>
				<div id="status">Welcome.</div>
			</div></td><td style="display:table-cell;vertical-align:middle;">
			<div id="bannerright">
				<div id="links">
					<a class="bannerlink" href="/software.html">Software Portfolio</a>|&nbsp
					<a class="bannerlink" href="/hobbies.html">Hobbies</a>|&nbsp
					<a class="bannerlink" href="/blog/">Blog</a>|&nbsp
					<a class="bannerlink" href="/cms/">Manage</a>|&nbsp
					<a class="bannerlink" href="/extras.html">Extras</a>
				</div>
			</div></td></tr>
		</table>
		<div id="contentborder">
			<div id="content">
				<h2>Content Management</h2>
<div style="display:none;" id="loggedInLinks">
<a href="/cms/account.html">Account</a>&nbsp|
<a href="/cms/threads.html">Threads</a>&nbsp|
<a id="logoutButton" href="#">Logout</a>
<br>
</div>
<div style="display:none;" id="loggedOutLinks">
<a href="/cms/login.html">Login</a>&nbsp|&nbsp
<a href="/cms/register.html">Register</a>
</div>
<hr>
<script>
	sub_scripts.push(function(){
		var status = document.getElementById("status");
	
		document.getElementById("logoutButton").onclick = function() {
			localStorage.removeItem(localStorageUsernameKey);
			localStorage.removeItem(localStorageTokenKey);
			window.location.href = "/cms/login.html";
		};
		
		var loggedInLinks = document.getElementById("loggedInLinks");
		var loggedOutLinks = document.getElementById("loggedOutLinks");

		if(localStorage.getItem(localStorageTokenKey) !== null &&
		localStorage.getItem(localStorageTokenKey) !== "undefined"){
			callAPI("POST", "/token", {"token": localStorage.getItem(localStorageTokenKey)}, function(response){
				if(typeof(response.error) === 'undefined'){
					if(!flashed){
						status.innerHTML = "Logged in as " + localStorage.getItem(localStorageUsernameKey);
					}
			
					loggedInLinks.style.display = "inline";
					loggedOutLinks.style.display = "none";
				}else{
					loggedInLinks.style.display = "none";
					loggedOutLinks.style.display = "inline";
			
					localStorage.removeItem(localStorageUsernameKey);
					localStorage.removeItem(localStorageTokenKey);
			
					redirect_flash("/cms/login.html", "Not logged in.");
				}
			});
		}else{
			if(!flashed){
				status.innerHTML = "Not logged in.";
			}
	
			loggedInLinks.style.display = "none";
			loggedOutLinks.style.display = "inline";
		}
	});
</script>
<h3 id="threadNameField"></h3>
<div id="threadDescriptionField"></div>
<br>
<a id="backButton" href="#">Back</a> | <a id="newMessageButton" href="#">New Message</a> | <a id="editThreadButton" href="#">Edit</a> | <a id="deleteThreadButton" href="#">Delete</a>
<br>
<hr>
<div id="threadMessages"></div>
<script>
	sub_scripts.push(function(){
		var status = document.getElementById("status");
		if(!("id" in urlParams)){
			window.location.href = "/cms/threads.html";
		}
	
		document.getElementById("backButton").onclick = function() {
			window.location.href = "/cms/threads.html";
		}
	
		document.getElementById("editThreadButton").onclick = function() {
			window.location.href = "/cms/edit_thread.html?id=" + urlParams["id"];
		}
	
		document.getElementById("newMessageButton").onclick = function() {
			window.location.href = "/cms/new_message.html?tid=" + urlParams["id"];
		}
	
		callAPI("GET", "/thread?id=" + urlParams["id"], {}, function(response){
			if(typeof(response.error) === 'undefined'){
				state.tid = response[0]["id"];
				document.getElementById("threadNameField").innerHTML = response[0]["name"];
				document.getElementById("threadDescriptionField").innerHTML = response[0]["description"];
			
				callAPI("GET", "/thread/messages?id=" + urlParams["id"], {}, function(response){
					if(typeof(response.error) === 'undefined'){
						var newhtml = "<h4>Messages:</h4>";
						if(response.length == 0){
							newhtml += "No messages.";
						}
						for(var i = 0, len = response.length; i < len; i++){
							newhtml += "<a href='/cms/message.html?tid=" + urlParams["id"] + "&mid=" + response[i].id + "'>" + (response.length - i) + ". " + response[i].title + "</a><br>";
						}
						document.getElementById("threadMessages").innerHTML = newhtml;
					}else{
						status.innerHTML = response.error;
					}
				});
			}else{
				status.innerHTML = response.error;
			}
		});
		
		document.getElementById("deleteThreadButton").onclick = function() {
			if(window.confirm("Delete thread " + document.getElementById("threadNameField").innerHTML + " ?")){
				callAPI("DELETE", "/thread", {"token": localStorage.getItem(localStorageTokenKey), "id": state.tid}, function(response){
					if(typeof(response.error) === 'undefined'){
						redirect_flash("/cms/threads.html", "Thread deleted!");
					}else{
						status.innerHTML = response.error;
					}
				});
			}
		};
	});
</script>


			</div>
		</div>
	</body>
</html>
