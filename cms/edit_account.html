<html>
	<head>
		<title>Content Management</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=0.8">
		
		<link href="https://fonts.googleapis.com/css?family=Vollkorn" rel="stylesheet">
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
		<link rel="stylesheet" type="text/css" href="/index.css">
		
		<script src="/index.js"></script>
	</head>
	<body>
		<!--
		
		Set to display:table; to show this loading screen.
		
		-->
		<div style="z-index:1;background-color:white;display:none;position:absolute;height:100%;width:100%;overflow:hidden;">
			<div style="display:table-cell;vertical-align:middle;">
				<div style="margin-left:auto;margin-right:auto;width:100%;text-align:center;">
					<svg style="width:80;height:80;">
						<rect x="0" y="0" height="16" width="16" style="fill:crimson;">
							<animate id="box1a1" attributeName="x"
								from="0"  to="60"
								begin="0s; box1a2.end" dur="1s"
								fill="freeze"/>
							<animate id="box1a2" attributeName="y"
								from="0"  to="60"
								begin="box1a1.end" dur="750ms"
								fill="remove"/>
						</rect>
						<rect x="60" y="60" height="16" width="16" style="fill:crimson;">
							<animate id="box2a1" attributeName="x"
								from="60"  to="0"
								begin="0s; box2a2.end" dur="1s"
								fill="freeze"/>
							<animate id="box2a2" attributeName="y"
								from="60"  to="0"
								begin="box2a1.end;" dur="750ms"
								fill="remove"/>
						</rect>
					</svg>
				</div>
			</div>
		</div>
		
		
		<table id="banner"><tr><td>
			<div id="bannerleft">
				<div id="icon"><img src="/favicon.ico"/></div>
				<div id="status">Welcome.</div>
			</div></td><td style="display:table-cell;vertical-align:middle;">
			<div id="bannerright">
				<div id="links">
					<a class="bannerLink" href="/cms/">Manage</a>&nbsp&nbsp|&nbsp
					<a class="bannerLink" href="/chat/">Chat</a>&nbsp&nbsp
				</div>
			</div></td></tr>
		</table>
		<div id="contentborder">
			<div id="content">
				
<h2>Content Management</h2>
<div style="display:none;" id="loggedInLinks">
<a href="/cms/account.html">Account</a>&nbsp|
<a href="/cms/threads.html">Threads</a>&nbsp|
<a id="logoutButton" href="#">Logout</a>
<br>
</div>
<div style="display:none;" id="loggedOutLinks">
<a href="/cms/login.html">Login</a>&nbsp|&nbsp
<a href="/cms/register.html">Register</a>
</div>
<hr>
<script>
	sub_scripts.push(function(){
		var status = document.getElementById("status");
	
		document.getElementById("logoutButton").onclick = function() {
			localStorage.removeItem(localStorageUsernameKey);
			localStorage.removeItem(localStorageTokenKey);
			window.location.href = "/cms/login.html";
		};
		
		var loggedInLinks = document.getElementById("loggedInLinks");
		var loggedOutLinks = document.getElementById("loggedOutLinks");

		if(localStorage.getItem(localStorageTokenKey) !== null &&
		localStorage.getItem(localStorageTokenKey) !== "undefined"){
			callAPI("POST", "/token", {"token": localStorage.getItem(localStorageTokenKey)}, function(response){
				if(typeof(response.error) === 'undefined'){
					if(!flashed){
						status.innerHTML = "Logged in as " + localStorage.getItem(localStorageUsernameKey);
					}
			
					loggedInLinks.style.display = "inline";
					loggedOutLinks.style.display = "none";
				}else{
					loggedInLinks.style.display = "none";
					loggedOutLinks.style.display = "inline";
			
					localStorage.removeItem(localStorageUsernameKey);
					localStorage.removeItem(localStorageTokenKey);
			
					redirect_flash("/cms/login.html", "Not logged in.");
				}
			});
		}else{
			if(!flashed && window.location.pathname.split("/").pop() != "register.html"){
				redirect_flash("/cms/login.html", "Not logged in.");
			}
	
			loggedInLinks.style.display = "none";
			loggedOutLinks.style.display = "inline";
		}
	});
</script>
<h2>Edit Account</h2>
<a href="/cms/account.html">Back</a>
<br>
<label for="usernameField">Username:&nbsp&nbsp</label>
<input type="text" autocomplete="off" id="usernameField">
<br>
<br>
<label for="passwordCheckbox">New Password</label>
<input type="checkbox" id="passwordCheckbox">
<div id="showPasswordField" style="display:none;">
<label for="passwordField">Password:&nbsp&nbsp</label>
<input type="password" autocomplete="off" id="passwordField">
</div>
<br>
<br>
<label for="emailField">Email:&nbsp&nbsp</label>
<input type="text" autocomplete="off" id="emailField">
<br>
<br>
<label for="firstNameField">First Name:&nbsp&nbsp</label>
<input type="text" autocomplete="off" id="firstNameField">
<br>
<br>
<label for="lastNameField">Last Name:&nbsp&nbsp</label>
<input type="text" autocomplete="off" id="lastNameField">
<br>
<br>
<label for="colorField">Color (e.g. "gold" or "#ffd700"):&nbsp&nbsp</label>
<input type="text" autocomplete="off" id="colorField">
<br>
<br>
<input id="updateButton" type="button" value="Update">
<br>
<script>
	sub_scripts.push(function(){
		var status = document.getElementById("status");
		
		document.getElementById("passwordCheckbox").onchange = function(){
			if(document.getElementById("passwordCheckbox").checked){
				document.getElementById("showPasswordField").style.display = "block";
			}else{
				document.getElementById("showPasswordField").style.display = "none";
			}
		};
		
		callAPI("POST", "/get/my/user", {"token": localStorage.getItem(localStorageTokenKey)}, function(response){
			if(typeof(response.error) === 'undefined'){
				usernameField.value = response[0]["username"];
				emailField.value = response[0]["email"];
				firstNameField.value = response[0]["first_name"];
				lastNameField.value = response[0]["last_name"];
				colorField.value = response[0]["color"];
			}else{
				status.innerHTML = response.error;
			}
		});
		
		document.getElementById("updateButton").onclick = function() {
			var new_values = {"username": document.getElementById("usernameField").value,
			"email": document.getElementById("emailField").value,
			"first_name": document.getElementById("firstNameField").value,
			"last_name": document.getElementById("lastNameField").value,
			"color": document.getElementById("colorField").value}
			
			if(document.getElementById("passwordCheckbox").checked){
				new_values["password"] = document.getElementById("passwordField").value;
			}
		
			callAPI("PUT", "/user", {"token": localStorage.getItem(localStorageTokenKey), "values": new_values}, function(response){
				if(typeof(response.error) === 'undefined'){
					localStorage.setItem(localStorageUsernameKey, document.getElementById("usernameField").value);
					localStorage.setItem(localStorageTokenKey, response.token);
					redirect_flash("/cms/account.html", "Account details, saved!");
				}else{
					status.innerHTML = response.error;
				}
			});
		};
	});
</script>


			</div>
		</div>
	</body>
	<script>
		sub_scripts.push(function(){
			var icon = document.getElementById("icon");
			icon.onclick = function(){
				window.location = "/index.html";
			};
		});
	</script>
</html>
